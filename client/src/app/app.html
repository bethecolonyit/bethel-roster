<mat-sidenav-container class="app-shell">
  <!-- SIDE NAV -->
  <mat-sidenav
  *ngIf="!isLoginPage"
  #sidenav
  class="app-sidenav"
  fixedInViewport
  [mode]="(isHandset$ | async) ? 'over' : 'side'"
  [opened]="(isHandset$ | async) ? false : !isCollapsed"
  [class.collapsed]="!(isHandset$ | async) && isCollapsed"
>
    <!-- Brand / Logo -->
    <mat-toolbar color="primary" class="app-sidenav-header">
      <span class="logo" *ngIf="!isCollapsed">Menu</span>
      <mat-icon *ngIf="isCollapsed">dashboard</mat-icon>
    </mat-toolbar>

    <!-- NAV LINKS -->
<mat-nav-list>
  <a
    mat-list-item
    routerLink="/dashboard"
    routerLinkActive="active-link"
    [routerLinkActiveOptions]="{ exact: true }"
  >
    <mat-icon matListItemIcon>dashboard</mat-icon>
    <span class="menu-label">Dashboard</span>
  </a>

  <a
    mat-list-item
    routerLink="/students"
    routerLinkActive="active-link"
  >
    <mat-icon matListItemIcon>groups</mat-icon>
    <span class="menu-label">Students</span>
  </a>

  <a
    mat-list-item
    routerLink="/residential"
    routerLinkActive="active-link"
    *ngIf="auth.isAdmin"
  >
    <mat-icon matListItemIcon>apartment</mat-icon>
    <span class="menu-label">Residential</span>
  </a>

  <a
    mat-list-item
    routerLink="/users"
    routerLinkActive="active-link"
    *ngIf="auth.isAdmin"
  >
    <mat-icon matListItemIcon>badge</mat-icon>
    <span class="menu-label">Users</span>
  </a>

  <!-- PARENT: Departments -->
  <button
    class="nav-button"
    mat-list-item
    type="button"
    (click)="departmentsOpen = !departmentsOpen"
    *ngIf="auth.isAdmin"
    [class.expanded]="departmentsOpen"
  >
    <mat-icon matListItemIcon>business</mat-icon>
    <span class="menu-label">Departments</span>

    <!-- spacer to push expand icon to the right -->
    <span class="menu-spacer"></span>

    <mat-icon class="expand-icon">
      {{ departmentsOpen ? 'expand_less' : 'expand_more' }}
    </mat-icon>
  </button>

  <!-- CHILD LINKS: only visible when open -->
  <div *ngIf="departmentsOpen" class="sub-nav">
    <a
      mat-list-item
      routerLink="/departments/c-coord-dashboard"
      routerLinkActive="active-link"
    >
      <span class="sub-label">Counseling Coordinator</span>
    </a>
    <a
      mat-list-item
      routerLink="/departments/counseling"
      routerLinkActive="active-link"
    >
      <span class="sub-label">Counseling</span>
    </a>
    <a
      mat-list-item
      routerLink="/departments/office"
      routerLinkActive="active-link"
    >
      <span class="sub-label">Office</span>
    </a>
    <a
      *ngIf="auth.isAdmin"
      mat-list-item
      routerLink="/departments/project-office"
      routerLinkActive="active-link"
    >
      <span class="sub-label">Project Office</span>
    </a>
    <a
      mat-list-item
      routerLink="/departments/hr"
      routerLinkActive="active-link"
    >
      <span class="sub-label">Human Resources</span>
    </a>
  </div>
</mat-nav-list>

  </mat-sidenav>

  <!-- MAIN CONTENT -->
  <mat-sidenav-content>
    <!-- TOP APP BAR -->
<mat-toolbar color="primary" class="app-toolbar">
  <!-- Hamburger: only when sidenav exists -->
  <button
    *ngIf="!isLoginPage"
    type="button"
    mat-icon-button
    (click)="toggleSidebar()"
    aria-label="Toggle navigation"
  >
    <mat-icon>menu</mat-icon>
  </button>

  <span class="app-title">Bethel Roster</span>

  <span class="spacer"></span>

  <!-- Theme toggle: you can keep this on login if you like -->
  <button
    mat-icon-button
    (click)="toggleTheme()"
    aria-label="Toggle theme"
  >
    <mat-icon>{{ isDarkMode ? 'dark_mode' : 'light_mode' }}</mat-icon>
  </button>

  <!-- Right-side actions: probably hide on login too -->
  <button
    *ngIf="!isLoginPage"
    mat-icon-button
    aria-label="Notifications"
  >
    <mat-icon>notifications</mat-icon>
  </button>

  <button
    *ngIf="!isLoginPage"
    mat-icon-button
    aria-label="User account"
    routerLink="/employees/me"
  >
    <mat-icon>account_circle</mat-icon>
  </button>

  <button
    *ngIf="!isLoginPage"
    mat-icon-button
    (click)="onLogout()"
    aria-label="Logout"
  >
    <mat-icon>logout</mat-icon>
  </button>
</mat-toolbar>

    <!-- Routed views render here (login OR dashboard OR students, etc.) -->
    <router-outlet></router-outlet>
  </mat-sidenav-content>
</mat-sidenav-container>
