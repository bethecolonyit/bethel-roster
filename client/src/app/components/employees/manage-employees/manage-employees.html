<div class="section-container">
  <mat-card class="section-card">
    <mat-card-header>
      <div mat-card-avatar class="title-icon-container">
        <mat-icon class="title-icon">assignment_ind</mat-icon>
      </div>

      <mat-card-title>Employee Management Dashboard</mat-card-title>

      <mat-card-subtitle>
        @if (!showForm) {
          Click the + button to create an employee, or edit an existing employee below.
        } @else {
          {{ isEditMode ? 'Edit Employee' : 'Create Employee' }}
        }
      </mat-card-subtitle>

      <span class="flex-spacer"></span>

      <!-- Top-right action button -->
      @if (!showForm) {
        <button
          mat-icon-button
          color="primary"
          matTooltip="Create Employee"
          aria-label="Create Employee"
          (click)="openCreateForm()">
          <mat-icon>add</mat-icon>
        </button>
      } @else {
        <button
          mat-icon-button
          matTooltip="Close Form"
          aria-label="Close Form"
          (click)="closeForm()">
          <mat-icon>close</mat-icon>
        </button>
      }
    </mat-card-header>

    @if (showForm) {
      <mat-card-content>
        <form [formGroup]="employeeForm" (ngSubmit)="submitEmployee()" class="employee-form">
          <div class="form-row">
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Link to User</mat-label>
              <mat-select formControlName="userId" required>
                @for (u of users; track u.id) {
                  <mat-option [value]="u.id">{{ u.email }}</mat-option>
                }
              </mat-select>
            </mat-form-field>

            <mat-form-field appearance="outline" class="form-field">
              <mat-label>First Name</mat-label>
              <input matInput formControlName="firstName" />
            </mat-form-field>

            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Last Name</mat-label>
              <input matInput formControlName="lastName" />
            </mat-form-field>

            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Hire Date</mat-label>
              <input matInput [matDatepicker]="picker" formControlName="hireDate" />
              <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
              <mat-datepicker #picker></mat-datepicker>
            </mat-form-field>
          </div>

          <div class="form-actions">
            <button mat-raised-button color="primary" type="submit">
              {{ isEditMode ? 'Save Changes' : 'Create Employee' }}
            </button>

            <button mat-button type="button" (click)="closeForm()">Cancel</button>
          </div>

          @if (error) {
            <div class="error-text">{{ error }}</div>
          }
        </form>
      </mat-card-content>
    }
  </mat-card>
</div>

<div class="section-container">
  <mat-card class="section-card">
    <mat-card-header>
      <div mat-card-avatar class="title-icon-container">
        <mat-icon class="title-icon">assignment_ind</mat-icon>
      </div>
      <mat-card-title>Employees</mat-card-title>
      <mat-card-subtitle>All Employees</mat-card-subtitle>
      <span class="flex-spacer"></span>
    </mat-card-header>

    <mat-card-content>
      <table class="assignment-table mat-elevation-z2">
        <thead>
          <tr class="table-row">
            <th>User</th>
            <th>First Name</th>
            <th>Last Name</th>
            <th>Hire Date</th>
            <th class="actions-col">Actions</th>
          </tr>
        </thead>

        <tbody>
          @for (employee of employees; track employee) {
            <tr>
              <td>{{ getUserDisplayName(employee.userId) }}</td>
              <td>{{ employee.firstName }}</td>
              <td>{{ employee.lastName }}</td>
              <td>{{ employee.hireDate | date }}</td>
              <td class="actions-col">
                <button
                  mat-icon-button
                  color="primary"
                  matTooltip="Edit Employee"
                  aria-label="Edit Employee"
                  (click)="openEditForm(employee)">
                  <mat-icon>edit</mat-icon>
                </button>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </mat-card-content>
  </mat-card>
</div>
